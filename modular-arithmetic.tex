\chapter{Modular arithmetic}
\epigraph[author={Carl Friedrich Gauss}]{Mathematics is the queen of the sciences and number theory is the queen of mathematics.}\SubIndex{Gauss, Carl Friedrich}
\section{Definition}
If we divide integers by \(7\), the possible remainders are
\[
0, 1, 2, 3, 4, 5, 6.
\]
For example, \(65=9 \cdot 7+2\), so the remainder is \(2\).
Two integers are \emph{congruent mod \(7\)} if they have the same remainder modulo \(7\).
So \(65\) and \(2\) are congruent mod \(7\), because \(65=9 \cdot 7 + 2\) and \(2=0 \cdot 7 + 2\).
We denote congruence modulo \(7\) as
\[
\congmod[7]{65}{2}.\Notation{b=c mod m}{\congmod[m]{b}{c}}{\(b\) is congruent to \(c\) modulo \(m\)}
\]
Sometimes we will allow ourselves a sloppy notation, where we write the remainder of \(65\) modulo \(7\) as \(\overline{65}\).\Notation{bb}{\bar{b}}{congruence class of \(b\)}
This is sloppy because the notation doesn't remind us that we are working out remainders modulo \(7\).
If we change \(7\) to some other number, we could get confused by this notation.
We will often compute remainders modulo some chosen number, say \(m\), instead of \(7\).

If we add multiples of \(7\) to an integer, we don't change its remainder modulo \(7\):
\[
\overline{65+7}=\overline{65}.
\]
Similarly, 
\[
\overline{65-7}=\overline{65}.
\]

If we add, or multiply, some numbers, what happens to their remainders?
\begin{theorem}
Take a positive integer \(m\) and integers \(a, A, b, B\).
If \(\congmod[m]{a}{A}\) and \(\congmod[m]{b}{B}\) then
\begin{align*}
a+b &\equiv A+B \pmod{m}, \\
a-b &\equiv A-B \pmod{m}, \\
\text{and } ab &\equiv AB \pmod{m}.
\end{align*}
\end{theorem}
The bar notation is more elegant.
If we agree that \(\bar{a}\) means remainder of \(a\) modulo the fixed choice of integer \(m\), we can write this as: if
\[
\bar{a}=\bar{A} \text{ and } \bar{b}=\bar{B}
\]
then
\begin{align*}
\overline{a+b}&=\overline{A+B}, \\
\overline{a-b}&=\overline{A-B}, \text{ and } \\
\overline{ab}&=\overline{AB}.
\end{align*}
\begin{example}
Note that \(\congmod[7]{9}{2}\) and \(\congmod[7]{4}{11}\), so our theorem tells us that \(\congmod[7]{9 \cdot 4}{2 \cdot 11}\).
Let's check this. 
The left hand side:
\begin{align*}
9 \cdot 4
&=
36,
\\
&=
5(7)+1,
\end{align*}
so that \(\congmod[7]{9 \cdot 4}{1}\).
The right hand side:
\begin{align*}
2 \cdot 11
&=
22,
\\
&=
3(7)+1,
\end{align*}
so that \(\congmod[7]{2 \cdot 11}{1}\).
\end{example}
So it works in this example.
Let's prove that it always works.
\begin{proof}
Since \(a-A\) is a multiple of \(m\), as is \(b-B\), note that
\[
(a+b)-(A+B)=(a-A)+(b-B)
\]
is also a multiple of \(m\), so addition works.
In the same way
\[
ab-AB=(a-A)b+A(b-B)
\]
is a multiple of \(m\).
\end{proof}
\begin{problem}{modular.arithmetic:perfect.square}
Prove by induction that every ``perfect square'', i.e. integer of the form \(n^2\), has remainder \(0, 1\) or \(4\) modulo \(8\).
\end{problem}
\begin{problem}{modular.arithmetic:nine}
Take an integer like \(243098\) and write out the sum of its digits \(2+4+3+0+9+8\).
Explain why every integer is congruent to the sum of its digits, modulo \(9\).
\end{problem}
\begin{answer}{modular.arithmetic:nine}
A \(1\)-digit positive integer has the form \(b=b_0\) with \(0 \le b_0 \le 9\) its first digit.
A \(2\)-digit positive integer has the form \(b=b_0+10 \, b_1\) with \(0 \le b_0,b_1 \le 9\).
In general, an \(n\)-digit positive integer has the form 
\[
b=b_0+10 \, b_1 + 10^2 \, b_2 + \dots + 10^{n-1} b_{n-1}.
\]
Modulo \(9\), \(\congmod[9]{10}{1}\), so modulo 9
\begin{align*}
\congmod[9]{b&}{b_0+10 \, b_1 + 10^2 \, b_2 + \dots + 10^{n-1} b_{n-1}},
\\
\congmod[9]{&}{b_0+b_1+b_2 + \dots + b_{n-1}}.
\end{align*}
\end{answer}
\begin{problem}{modular.arithmetic:gcd}
Take integers \(a,b,m\) with \(m \ne 0\).
Let \(d\defeq\gcd{a,b,m}\).
Prove that \(\congmod[m]{a}{b}\) just when \(\congmod[m/d]{a/d}{b/d}\).
\end{problem}
\begin{problem}{modular.arithmetic:5n.plus.7}
Why is \(5^n+7\) divisible by \(4\) for every \(n=1,2,3,\dots\)?
\end{problem}

\section{Arithmetic of remainders}
We now \emph{define} an addition law on the numbers \(0,1,2,3,4,5,6\) by declaring that when we add these numbers, we then take remainder modulo \(7\); this is \emph{modular arithmetic}.\define{modular arithmetic}
This is \emph{not} usual addition.
To make this clear, we write the remainders with bars over them, always.
For example, we are saying that in this addition law \(\bar{3}+\bar{5}\) means \(\overline{3+5}=\overline{8}=\bar{1}\), since we are working modulo \(7\).
We adopt the same rule for subtraction, and for multiplication.
For example, modulo \(13\),
\begin{align*}
\pr{\bar{7}+\bar{9}}\pr{\overline{11}+\bar{6}}
&=
\overline{16} \cdot \overline{17},
\\
&=
\overline{13+3} \cdot \overline{13+4},
\\
&=
\overline{3} \cdot \overline{4},
\\
&=
\overline{12}.
\end{align*}
If we are daring, we might just drop all of the bars, and state clearly that we are calculating modulo some integer.
In our daring notation, modulo 17,
\begin{align*}
16 \cdot 29 - 7 \cdot 5 
&=
16 \cdot 12 - 7 \cdot 5,
\\
&=
192 - 35,
\\
&=
\pr{11\cdot 17 + 5} - \pr{2 \cdot 17 + 1},
\\
&=
5 - 1,
\\
&=
4.
\end{align*}
\begin{problem}{modular.arithmetic:examples}
Expand and simplify \(\bar{5}\cdot\bar{2} \cdot \pr{\bar{6}-\bar{9}}\) modulo \(7\).
\end{problem}

The addition and multiplication tables for remainder modulo \(5\):
\[
\begin{array}{@{}r|rrrrr@{}}
+ & 0 & 1 & 2 & 3 & 4 \\ \hline
0 & 1 & 2 & 3 & 4 & 0 \\
1 & 2 & 3 & 4 & 0 & 1 \\
2 & 3 & 4 & 0 & 1 & 2 \\
3 & 4 & 0 & 1 & 2 & 3 \\
4 & 0 & 1 & 2 & 3 & 4
\end{array}
\qquad
\begin{array}{@{}r|rrrrr@{}}
\cdot & 0 & 1 & 2 & 3 & 4 \\ \hline
    0 & 0 & 0 & 0 & 0 & 0 \\
    1 & 0 & 1 & 2 & 3 & 4 \\
    2 & 0 & 2 & 4 & 1 & 3 \\
    3 & 0 & 3 & 1 & 4 & 2 \\
    4 & 0 & 4 & 3 & 2 & 1
\end{array}
\]
\begin{problem}{modular.arithmetic:laws}
Describe laws of modular arithmetic, imitating the laws of integer arithmetic.
If we work modulo \(4\), explain why the zero divisors law fails.
Why are there no sign laws?
\end{problem}
\begin{problem}{modular.arithmetic:remainder}
Compute the remainder when dividing \(19\) into \(37^{200}\).
\end{problem}
\begin{problem}{modular.arithmetic:remainder.2}
Compute the last two digits of \(9^{2000}\).
\end{problem}
\begin{problem}{modular.arithmetic:quartic}
Use modular arithmetic to prove that the integer coefficient polynomial
\[
b(x)=2x^4-2x+7
\]
has no integer roots.
\end{problem}
\begin{problem}{modular.arithmetic:quad.eqn}
Prove that the equation \(a^2 + b^2 = 3c^2\) has no solutions in nonzero integers \(a\), \(b\) and \(c\).
Hint: start by proving that modulo \(4\), \(a^2=0\) or \(1\).
Then consider the equation modulo 4; show that \(a\), \(b\) and \(c\) are divisible by 2. Then each of \(a^2\), \(b^2\) and \(c^2\) has a factor of 4. 
Divide through by 4 to show that there would be a smaller set of solutions to the original equation.
Apply induction.
\end{problem}
\begin{example}
To carry a remainder to a huge power, say \(2^{2005}\) modulo \(13\), we can build up the power out of smaller ones.
For example, \(2^2=4\) modulo \(13\), and therefore modulo \(13\),
\begin{align*}
2^4
&=
\pr{2^2}^2,
\\
&=4^2,
\\
&=16,
\\
&=3.
\end{align*}
Keeping track of these partial results as we go, modulo \(13\),
\begin{align*}
2^8
&=
\pr{2^4}^2,
\\
&=
3^2,
\\
&=9.
\end{align*}
We get higher and higher powers of \(2\): modulo \(13\),
\[
\begin{array}{@{}rrr@{}}
\toprule 
k & 2^k & 2^{2^k} \operatorname{mod} 13 \\
\cmidrule(r){1-1}\cmidrule(lr){2-2}\cmidrule(l){3-3}
0 & 1 & 2 \\
1 & 2 & 4 \\
2 & 4 & 3 \\
3 & 8 & 9 \\
4 & 16 & 9^2=81=3\\
5 & 32 & 3^2=9 \\
6 & 64 & 9^2=3 \\
7 & 128 & 3^2=9\\
8 & 256 & 9^2=3 \\
9 & 512 & 3^2=9 \\
10 & 1024 & 9^2=3 \\
11 & 2048 & 
\\ \bottomrule
\end{array}
\]
The last row gets into \(2^{2048}\), too large to be relevant to our problem.
We now want to write out exponent \(2005\) as a sum of powers of \(2\), by first dividing in \(1024\):
\begin{align*}
2005
&=
1024
+
981
\\
\intertext{and then dividing in the next power of \(2\) we can fit into the remainder,}
&= 1024 + 512 + 469,
\\
&= 1024 + 512 + 256 + 128 + 64 + 16 + 4 + 1.
\end{align*}
Then we can compute out modulo \(13\):
\begin{align*}
2^{2005}
&=
2^{1024 + 512 + 256 + 128 + 64 + 16 + 4 + 1},
\\
&=
2^{1024} 2^{512} 2^{256} 2^{128} 2^{64} 2^{16} 2^4 2^1,
\\
&=
3 \cdot 9 \cdot 3 \cdot 9 \cdot 3 \cdot 3 \cdot 3 \cdot 2,
\\
&=
\pr{3 \cdot 9}^3 \cdot 2,
\\
&=
27^2 \cdot 2,
\\
&=
1^2 \cdot 2,
\\
&=
2.
\end{align*}
\begin{problem}{modular:big.power}
Compute \(2^{100}\) modulo \(125\).
\end{problem}
\begin{problem}{modular:pq.zero.divisors}
A \emph{zero divisor}\SubIndex{zero divisor} among the remainders modulo an integer \(m>0\) is a remainder \(b\) for which there is a nonzero remainder \(c\) so that \(bc=0\) modulo \(m\).
Suppose that \(m\) is a product of two primes, say \(m=pq\).
How do we find the number of zero divisors among the remainders modulo \(m\)?
\end{problem}
\begin{answer}{modular:pq.zero.divisors}
\(p+q-2\)
\end{answer}
\end{example}
\begin{problem}{modular.arithmetic:poly}
Use modular arithmetic to prove that the integer coefficient polynomial
\[
b(x)=x^4-2x-7
\]
has no integer roots.
\end{problem}
\begin{answer}{modular.arithmetic:poly}
Mod \(3\), \(b(x)=x^4+x+2\).
We plug in \(x=0,1,2\) and take remainder modulo \(3\) to find that these are not roots:
\[
\begin{array}{rl}
\toprule
x&x^4+x+2\pmod{3}\\
\midrule
0&0^4+0+2=2\\
1&1^4+1+2=1\\
2&2^4+2+2=2\\
\bottomrule
\end{array}
\]
Any root in integers would reduce modulo \(3\) to a root in remainders modulo \(3\).
\end{answer}

\section{Reciprocals}
Every nonzero rational number \(b/c\) has a reciprocal: \(c/b\).
Since we now have modular arithmetic defined, we want to know which remainders have ``reciprocals''.
Working modulo some positive integer, say that a remainder \(x\) has a reciprocal \(y=x^{-1}\) if \(xy=1\).
(It seems just a little too weird to write it as \(y=1/x\), but you can if you like.)
Reciprocals are also called \emph{multiplicative inverses}.\define{multiplicative inverse}
\begin{example}
Modulo \(7\)
\begin{align*}
\bar{1} \cdot \bar{1} &= \bar{1}, \\
\bar{2} \cdot \bar{4} &= \bar{1}, \\
\bar{3} \cdot \bar{5} &= \bar{1}, \\
\bar{4} \cdot \bar{2} &= \bar{1}, \\
\bar{5} \cdot \bar{3} &= \bar{1}, \\
\bar{6} \cdot \bar{6} &= \bar{1}.
\end{align*}
So in this weird type of arithmetic, we can allow ourselves the freedom to write these equations as identifying a reciprocal.
\begin{align*}
\bar{1}^{-1} &= \bar{1}, \\
\bar{2}^{-1} &= \bar{4}, \\
\bar{3}^{-1} &= \bar{5}, \\
\bar{4}^{-1} &= \bar{2}, \\
\bar{5}^{-1} &= \bar{3}, \\
\bar{6}^{-1} &= \bar{6}.
\end{align*}
\end{example}
A remainder that has a reciprocal is a \emph{unit}.\define{unit}
\begin{problem}{modular.arithmetic:no.reciprocal}
\emph{Danger:} If we work modulo \(4\), then prove that \(\bar{2}\) has \emph{no} reciprocal.
Hint: \(\bar{2}^2=0\).
\end{problem}
\begin{problem}{modular.arithmetic:reciprocal}
Prove that, modulo any positive integer \(m\), \(m-1\) has a reciprocal and that this reciprocal is \((m-1)^{-1}=m-1\).
\end{problem}
\begin{answer}{modular.arithmetic:reciprocal}
\((m-1)(m-1)=m^2-2m+1=1\) up to multiples of \(m\).
Careful: the following proof is not going to work. You might try to write that \((m-1)^{-1}\cong (-1)^{-1}\cong -1\) mod \(m\).
This doesn't work because you are assuming that \((-1)^{-1}\) can be calculated modulo \(m\) just as if it were being calculated first in the integers, and then reduced modulo \(m\). But the \(()^{-1}\) operation doesn't work like that: it doesn't commute with reduction modulo an integer.
Also, this incorrect attempt at a proof assumes that there is a reciprocal.
\end{answer}
\begin{theorem}
Take a positive integer \(m\) and a remainder \(\bar{r}\) modulo \(m\).
Take the B\'ezout coefficients of \(r\) and \(m\): \(sr+tm=d\), so that \(d\) is the greatest common divisor of \(r\) and \(m\).

If \(d=1\) then \(\bar{r}^{-1}=\bar{s}\) modulo \(m\).
If \(d \ne 1\) then \(\bar{r}^{-1}\) does not exist.
In particular, in the remainders modulo \(m\), a remainder \(\bar{r}\) is a unit just when \(r\) and \(m\) are coprime integers.
\end{theorem}
\begin{proof}
If \(r,m\) are coprime integers, so their greatest common divisor is \(1\), then write B\'ezout coefficients \(sr+tm=1\), and quotient by \(m\):
\[
\bar{s}\bar{r}=\bar{1}.
\]

On the other hand, if 
\[
\bar{s}\bar{r}=\bar{1},
\]
then \(sr\) is congruent to \(1\) modulo \(m\), i.e. there is some quotient \(q\) so that \(sr=qm+1\), so \(sr-qm=1\), giving B\'ezout coefficients \(s=s,t=-q\), so the greatest common divisor of \(r,m\) is \(1\).
\end{proof}
\begin{example}
Working modulo \(163\), let's compute \(14^{-1}\).
First we carry out the long division
\integerLongDivision{163}{14}
Now let's start looking for B\'ezout coefficients, by writing out matrix:
\[
\begin{pmatrix}
1 & 0 & 14 \\
0 & 1 & 163
\end{pmatrix}
\]
and then add \(-11\cdot\text{row 1}\) to row 2:
\[
\begin{pmatrix}
1 & 0 & 14 \\
-11 & 1 & 9
\end{pmatrix}.
\]
Add \(-\text{row 2}\) to row 1:
\[
\begin{pmatrix}
12 & -1 & 5 \\
-11 & 1 & 9
\end{pmatrix}.
\]
Add \(-\text{row 1}\) to row 2:
\[
\begin{pmatrix}
12 & -1 & 5 \\
-23 & 2 & 4
\end{pmatrix}.
\]
Add \(-\text{row 2}\) to row 1:
\[
\begin{pmatrix}
35 & -3 & 1 \\
-23 & 2 & 4
\end{pmatrix}.
\]
Add \(-4 \cdot \text{row 1}\) to row 2:
\[
\begin{pmatrix}
35 & -3 & 1 \\
-163 & 14 & 0
\end{pmatrix}.
\]
Summing it all up: \(35 \cdot 14 + (-3) \cdot 163 = 1\).
Quotient out by \(163\): modulo \(163\), \(35 \cdot 14 = 1\), so modulo \(163\), \(14^{-1}=35\).
\end{example}
\begin{problem}{modular.arithmetic:reciprocals}
Use this method to find reciprocals:
\begin{enumerate}
\item 
\(13^{-1}\) modulo \(59\)
\item
\(10^{-1}\) modulo \(11\)
\item
\(2^{-1}\) modulo \(193\).
\item
\(6003722857^{-1}\) modulo \(77695236973\).
\end{enumerate}
\end{problem}
\begin{answer}{modular.arithmetic:reciprocals}
\begin{enumerate}
\item 
\sagestr{bezpretty(13,59)}
Answer:\(13^{-1} = \sage{inverse_mod(13,59)}\) modulo \(59\)
\item
\sagestr{bezpretty(10,11)}
Answer:\(10^{-1} = \sage{inverse_mod(10,11)}\) modulo \(11\)
\item
\sagestr{bezpretty(2,193)}
Answer:\(2^{-1} = \sage{inverse_mod(2,193)}\) modulo \(193\)
\item
\sagestr{bezpretty(6003722857,77695236973)}
Answer:\(6003722857^{-1} = \sage{inverse_mod(6003722857,77695236973)}\) modulo \(77695236973\)
\end{enumerate}
\end{answer}
\begin{problem}{modular.arithmetic:prime.field}
Suppose that \(b, c\) are remainders modulo a prime.
Prove that \(bc=0\) just when either \(b=0\) or \(c=0\).
\end{problem}
\begin{problem}{modular.arithmetic:Fermats.Little.Theorem}
Suppose that \(p\) is a prime number and \(n\) is an integer with \(n < p\).
Explain why, modulo \(p\), the numbers \(0, n, 2n, 3n, \dots, (p-1)n\) consist in precisely the remainders \(0,1,2,\dots,p-1\), in some order.
(Hint: use the reciprocal of \(n\).)
Next, since every nonzero remainder has a reciprocal remainder, explain why the product of the nonzero remainders is \(1\).
Use this to explain why 
\[
\congmod[p]{n^{p-1}}{1}.
\]
Finally, explain why, for any integer \(k\),
\[
\congmod[p]{k^p}{k}.
\]
\end{problem}